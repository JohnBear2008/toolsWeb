<% layout(locals.global.theme_layout_dir+'/master.ejs') -%>


<!--本地路径-->
<link rel="stylesheet" type="text/css" href="/css/PM/PMContent.css">


<!-- CSS -->
<link rel="stylesheet" type="text/css" href="/css/PM/DataTables/Bootstrap-3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/PM/DataTables/DataTables-1.10.18/css/dataTables.bootstrap.min.css">

<!-- JS  -->
<script type="text/javascript"  src="/css/PM/DataTables/DataTables-1.10.18/js/jquery.dataTables.min.js"></script>
<script type="text/javascript"  src="/css/PM/DataTables/DataTables-1.10.18/js/dataTables.bootstrap.min.js"></script>


<script src="/js/PM/FileSaver.min.js"></script>
<script src="/js/PM/tableExport.js"></script>
<script src="/js/PM/PMfuns.js"></script>



<div class="content">
    <h1>客户信息维护</h1>
    <hr>
    <!--<button id="Add"  onclick="javascript:$('#win').window('open')">添加</button>-->
    <!-- 操作区（按钮等） -->
    <div class="lineitem">
        <button id="Add" class="btn btn-info">添加</button>
        <button id="Upd" class="btn btn-warning">更新</button>
        <button id="Del" class="btn btn-danger">删除</button>
    </div>
    <br/>

    <!--数据呈现区-->
    <table id="cust_DB" class="table table-striped table-bordered"  >
        <thead>
            <tr>
                <th>ID</th>
                <th>厂商码</th>
                <th>客户名称</th>
                <th>联系电话</th>
            </tr>
        </thead>
    </table>
    <!-- 点击更新、添加按钮后弹出的窗口 -->
    <div id="win" class="easyui-window" title="DBinfo" closed="true" style="width:400px;height:560px;">
        <form style="padding:10px 50px;">
            <p>厂商码 : <input id="cust_FID_Input" size="30" type="text" class="required"></p>
            <p>客户名称 : <input id="cust_Name_Input" size="30" type="text" class="required"></p>

          
            <div style="padding:5px;text-align:center;">
                <a id="AddDoButton"　href="#" class="easyui-linkbutton" icon="icon-ok">添加</a>
                <a id="UpdDoButton"　href="#" class="easyui-linkbutton" icon="icon-ok">更新</a>
                <a id="CancelButton" href="#" class="easyui-linkbutton" icon="icon-cancel">取消</a>
            </div>
        </form>
    </div>
</div>


<script>

//定义显示客户信息数据参数结构-------------
function factDataPara(tableID,DBTable) {
    this.tableID = tableID;
    this.DBTable = DBTable;
}

// 添加按钮-----
$('#Add').click(function() {
    $('#win').window('open');
    $('#AddDoButton').show();
    $('#UpdDoButton').hide();
    
});

//定义添加发送数据结构---------------------

function addDataInfo(DBTable,cust_FID,cust_Name){
	this.DBTable=DBTable;
	this.cust_FID=cust_FID;
	this.cust_Name=cust_Name;	
}



//form框添加按钮----------
$('#AddDoButton').click(function() {
	
	var DBTable="PM_customer";
	
	var cust_FID=$("#cust_FID_Input").val();
	var cust_Name=$("#cust_Name_Input").val();
	
	
	var DBData=new addDataInfo(DBTable,cust_FID,cust_Name);
	
	addDBData(DBData);
	
//    var UID = "";
//    // UID + form的数据 ==> 构造obj
//    var aRemainVal = [];
//    for (var ID in oInput) {
//        ID = "#" + ID;
//        var nVal = $(ID).val();
//        aRemainVal.push(nVal);
//    }
//    var formData = new moniData(UID, ...aRemainVal);
//    // alert("formData:" + JSON.stringify(formData));
//
//    if (checkinput(formData)) {
//        // 保存本次提交表格内数据的值至obj内，便于连续操作
//        var inputNum = $("#win").find("input").length;
//        for (var i = 0; i < inputNum; ++i) {
//            var inputElem = $("#win").find("input").eq(i);
//            var inputID = inputElem.attr("id");
//            // console.log("#1", inputID);
//            if (oInput.hasOwnProperty(inputID) && (aIgnID.indexOf(inputID) === -1)) {
//                var IDTmp = "#" + inputID; // id选择器要加个#
//                oInput[inputID] = $(IDTmp).val();
//            }
//        }
//        sessionStorage.setItem("lastFormData", JSON.stringify(oInput));
//        ajaxAdd(formData);
//    } else {
//        //  alert("输入错误");
//    }
	
	
});


//////判断是否选中数据-------
////var table = $('#cust_DB').DataTable();
//$('#cust_DB tbody').on('click', 'tr', function() {
//    if ($(this).hasClass('selected')) {
//        $(this).removeClass('selected');
//    } else {
//        table.$('tr.selected').removeClass('selected');
//        $(this).addClass('selected');
//    }
//});

//删除按钮----------
$('#Del').click(function() {
    var dataSelect = table.row('.selected').data();
    
    alert(dataSelect);
    
    if (dataSelect == undefined) {
        alert("当前未选择任何数据,请先点击需要删除的数据行!");
    } else {
        var msg1 = confirm("风险操作！此行数据内容移除后无法还原，请确认操作是否无误！");
        if (msg1 === true) {
            var msg2 = confirm("确认删除此行数据？");
            if (msg2 === true) {
                var UID = { "UID": dataSelect.UID };
                // alert("UID:"+UID);
             //   ajaxDel(UID);
            }
        }
    }
    //          table.row('.selected').remove().draw( false );//前端删除显示数据 ,数据库不删除
});






//form 更新按钮------------
$('#UpdDoButton').click(function() {
    var UID = table.row('.selected').data().UID;

    var aRemainVal = [];
    for (var ID in oInput) {
        ID = "#" + ID;
        var nVal = $(ID).val();
        aRemainVal.push(nVal);
    }
    var formData = new moniData(UID, ...aRemainVal);
    //      alert("formData:"+JSON.stringify(formData));
    if (checkinput(formData)) {
        //  alert("输入正确");
        ajaxUpd(formData);
    } else {
        //  alert("输入错误");
    }
});
//form框 取消按钮----------------
$('#CancelButton').click(function() {
    $('#win').window('close');
});


//页面加载函数---------------
$(document).ready( function () {
		
	var DataPara=new factDataPara("#cust_DB","PM_customer");
	var columnsData=[
		{ data: 'cust_ID' ,"visible": false},
        { data: 'cust_FID' },
        { data: 'cust_Name'},
        { data: 'cust_Phone'}
    ];

//	alert(JSON.stringify(DataPara));
	showDBData(DataPara,columnsData);
	
	
	
	
	
	
}); 

</script>
