<!-- 导入css库 -->
<link rel="stylesheet" type="text/css" href="/rpLib/css/divCss.css">

<!-- 导入js库 -->
<script type="text/javascript" src="/rpLib/publicFuns.js"></script>

<!-- 导入datatables -->
<link rel="stylesheet" type="text/css" href="/rpLib/DataTables/datatables.min.css" />
<script type="text/javascript" src="/rpLib/DataTables/datatables.min.js"></script>



<!-- 加载foil外框架 -->
<% layout(locals.global.theme_layout_dir+'/master.ejs') -%>

<!-- 定义html元素 -->
<div class="rpContent">

    <!-- 按钮：用于打开模态框 -->

    <div class="row clearfix">
        <div class="col-md-12 column">
            <div class="page-header">
                <h1>工作流程-显示面板</h1>
            </div>
        </div>
    </div>


    <div class="row clearfix">
        <div class="col-md-4 column">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">待维修</h3>
                </div>
                <div class="panel-body">
                    <table class="table" id='tableWait'>
                        <thead>
                            <th>产品</th>
                            <th>申请单号 </th>
                            <th>送修日期</th>
                        </thead>
                        <tbody></tbody>

                    </table>
                </div>

            </div>
        </div>


        <div class="col-md-4 column">
            <div class="panel panel-warning">
                <div class="panel-heading">
                    <h3 class="panel-title">维修中</h3>
                </div>
                <div class="panel-body">
                    <table class="table" id='tableDoing'>
                        <thead>
                            <th>产品</th>
                            <th>维修单号</th>
                            <th>维修日期</th>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
        </div>


        <div class="col-md-4 column">
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h3 class="panel-title">待出货</h3>
                </div>
                <div class="panel-body">
                    <table class="table" id='tableWaitSend'>
                        <thead>
                            <th>产品</th>
                            <th>客户 </th>
                            <th>数量</th>
                            <th>完成日期</th>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
        </div>


    </div>



</div>



<script type="text/javascript">
    //申请表子表dataTable column 数组
    const subColumnsArray = [{
        data: 'productId',
    }, {
        data: 'requestBillId',
    }, {
        data: 'billSaveTimeStamp',
    }]



    //用数组重载子表
    const loadDataSubTable = async (i) => {

        //加载表格
        loadBillDataTable({
            elementId: i.elementId,
            dtParams: {
                dtConfig: 'dtConfigData',
                data: dataArray,
                columns: subColumnsArray
            }
        })

        //如数据为0,清空tbody 避免直接获取size =1;
        if (dataArray.length === 0) {
            $('#rp_partsBills tbody').html("");
        }


    }
    //加载展开选定表子表关联数据

    const loadTrackTable = async (i) => {
        //加载表格
        loadBillDataTable({
            elementId: i.elementId,
            sqlParams: i.sqlParams,
            dtParams: {
                dtConfig: 'dtConfigSimple',
                columns: subColumnsArray
            }
        })


    }


    $(document).ready(function () {


        loadTrackTable({
            elementId: 'tableWait',
            sqlParams: {
                sqlId: 'sqlRecordBills',
                params: {
                    filter: 'billSaveTimeStamp is not null'
                }
            }
        })


        loadTrackTable({
            elementId: 'tableDoing',
            sqlParams: {
                sqlId: 'sqlRecordBills',
                params: {
                    filter: 'makeDate is not null'
                }
            }
        })





    });
</script>