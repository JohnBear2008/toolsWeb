<!--本地路径-->
<% layout(locals.global.theme_layout_dir+'/master.ejs') -%>
<link rel="stylesheet" type="text/css" href="/css/HMIPrint/divContent.css">
<script type="text/javascript" src="/js/muc_jsExtend.js"></script>
<script type="text/javascript" src="/js/HMIPrint/common.js"></script>
<script type="text/javascript" src="/js/HMIPrint/moniParse.js"></script>
<script type="text/javascript" src="/js/HMIPrint/lc_switch.min.js"></script>
<link rel="stylesheet" type="text/css" href="/css/HMIPrint/lc_switch.css">

<!-- <script src="/js/HMIPrint/FileSaver.min.js"></script> -->
<!-- <script src="/js/HMIPrint/tableExport.js"></script> -->

<!-- 新 Bootstrap 核心 CSS 文件 -->
<link href="/css/HMIPrint/bootstrap.min.css" rel="stylesheet">
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="/js/HMIPrint/bootstrap.min.js"></script>

<div class="divContent">
    <h1>Moni 文件解析</h1>
    <hr />
    <!-- 操作区（按钮等） -->
    <div class="input-append">
        <!-- 导出文件按键 -->
        <input type="file" id="upFolder" style="display:none;" webkitdirectory />
        <a class="btn btn-lg btn-info" onclick="$('input[id=upFolder]').click();">导入文件</a>

        <!--  汇出excel按键 -->
        <!-- 注：使用FileSaver，tableExport的旧方式，效率较低，故更换为blob方式 -->
        <!-- <button id="remitExcel" class=" btn btn-lg btn-default">汇出excel</button> -->
        <button id="remitExcel2" style="display:none;"></button>
        <a id="dlink" class=" btn btn-lg btn-default" onclick="$('button[id=remitExcel2]').click();">汇出excel</a>

        <!-- 进度提示 -->
        <label id="PMsg" style="font-weight: bold;font-size: 15px;color: red;margin-left: 20px"></label>

        <!-- 记录单选框 加个hidden是为了防止加载中留下残影-->
        <input id="recBox" type="checkbox" name="check-1" value="recOn" class="lcs_check" autocomplete="off" style="visibility: hidden;" />
    </div>
    </br>

    <!--数据呈现区-->
    <div>
        <table id="monidata" class="table table-bordered table-hover">
            <!-- thead 存放警报标题， eg. 开模序号、循环计时 。。。 -->
            <thead>
                <tr></tr>
            </thead>
            <!-- tbody 存放对应的资料值， eg.  1， 17.69 。。。 -->
            <tbody></tbody>
        </table>
    </div>
</div>
<script type="text/javascript" defer="defer">
/*jshint esversion:6*/
$(function(e) {
    /* “记录”checkbox初始化与事件绑定 */
    // waring:不能写在onload
    fnBindRecTrigger("sMoniRec", "#recBox", "记录", "关闭");
});

window.onload = function() {
    let mucDB = "MucDB",
        store = "HMIPrint",
        pageName = "moni",
        sRecFlag = "sMoniRec";

    let sRecStat = sessionStorage.getItem(sRecFlag); // String类型
    /* 呈现先前成功解析的obj，TODO 改为indexeddb的方式 */
    function callbackInxDB(data) {
        // console.log(data);
        fnPreObjShow(data);
        $("#PMsg").text("");
    }

    if (sRecStat === "true") {
        $("#PMsg").text("正在获取/解析数据文件，请稍后 . . .");
        fngetDataFrIndexedDB(mucDB, store, pageName, callbackInxDB);
    }

    /* 操作控件事件绑定 */
    // 上传文件夹
    $("#upFolder").change(function() {
        fnTrvlEvent();
    });

    $("#remitExcel2").click(function() {
        fnTableDataExport("#monidata", "#dlink", pageName, '.xls');
    });


};

</script>
